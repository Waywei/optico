{% extends "layout.html" %}

{% block page_title %}{{ p.Name }}{% endblock %}
{% block page_id%}page-product{% endblock %}

{% block body %}

<script type="text/javascript" src="{{ url_for('static', filename='js/optico-ps.js') }}"></script>
<script type="text/javascript">

$(document).ready(function(){
	// confirm delete
	$('#btn-delete-product').click(function(){
		return confirm("确认删除产品：{{ p.Name }} ?")? true: false;
	});

	$(document.body).on('click', '.btn-delete-para', function(){
		return confirm("确认删除此项产品参数 ?")? true: false;
	});

	$('table').addClass('table table table-bordered');
});
</script>

<div class="row">
	<div class="span3">
		<b>Products</b>
		
		{% from 'products_sidebar.widget' import show_ps %}
		{{ show_ps(ps)|safe }}

		<script type="text/javascript">
			// init sidebar
			init_ps(3, {{ p.ProductID }});
		</script>
	</div>

	<div class="span9">
		{% if session.user_id == admin_id %}
		<div class="btn-group pull-right">
			<a href="{{ url_for('delete_product', product_id=p.ProductID) }}" id="btn-delete-product" class="btn btn-small"><span class="icon-remove"></span> 删除</a>
			<a href="{{ url_for('edit_product', product_id=p.ProductID) }}" class="btn btn-small"><span class="icon-edit"></span> 编辑</a>
		</div>
		{% endif %}

		<ul class="breadcrumb">
			<li>
				<a href="{{ url_for('mtype', mtype_id=mt.MainTypeID) }}">{{ mt.Name }}</a> >
			</li>
			<li>
				<a href="{{ url_for('stype', stype_id=st.SubTypeID) }}">{{ st.Name }}</a> >
			</li>
		</ul>
		
		<h1>{{ p.Name }}</h1>
		<img class="p-img" src="{{ p.ImageUrl }}" />
		<div class="p-details">{{ p.Details|safe }}</div>

		<div class="tabbable">
			<ul class="nav nav-tabs">
				{% for p in paras %}
				<li 
				{% if loop.first %}class="active"{% endif %}
				><a href="#p_{{ p.ParamterID }}" data-toggle="tab">{{ p.Title }}</a></li>
				{% endfor %}
			</ul>

			<div class="tab-content">
				{% for p in paras %}
				<div class="tab-pane
				{% if loop.first %}active{% endif %} 
				" id="p_{{ p.ParamterID }}">
					{% if session.user_id == admin_id %}
					<div class="btn-group pull-right">
						<a class="btn btn-small btn-delete-para" href="{{ url_for('delete_para', para_id=p.ParamterID) }}"><span class="icon-remove"></span> 删除</a>
						<a class="btn btn-small" href="{{ url_for('edit_para', para_id=p.ParamterID) }}"><span class="icon-edit"></span> 编辑</a>
					</div>
					{% endif %}
					
					<div class="para-content">{{ p.Content|safe }}</div>
				</div>
				{% endfor %}
			</div>
		</div>

		{% if session.user_id == admin_id %}
		<form id="form-add-para" class="form-horizontal" method="post" action="{{ url_for('add_para', product_id=p.ProductID) }}">
			<fieldset>
				<legend>添加参数</legend>

				<div class="control-group">
					<label class="control-label">参数项</label>
					<div class="controls">
						<input type="text" class="input-xlarge" name="title" />
					</div>
				</div>

				<div class="control-group">
					<label class="control-label">内容</label>
					<div class="controls">
						<textarea class="input-xxlarge" rows="10" name="content"></textarea>
					</div>
				</div>

				<div class="control-group">
					<div class="controls">
						<input type="submit" value="提交" class="btn btn-primary" />
					</div>
				</div>

			</fieldset>
		</form>
		{% endif %}
	</div>	
</div>

{% endblock %}